var sharedData=null,storage=chrome.storage.local,errorNotOccur=!0;function relativeToAbsolute(e,t){"/"!=e[e.length-1]&&(e+="/");let i=e.substr(0,e.indexOf("/",e.indexOf("//")+2)),r=e.substr(e.indexOf("/",e.indexOf("//")+2));if(0===t.indexOf("/"))i+=t;else if(t.indexOf("://")>0)i=t;else{for(;0===t.indexOf("../");)if(t=t.substring(3),"/"!==r){let e=r.lastIndexOf("/",r.length-2);r=r.substring(0,e+1)}i+=r+t}return i}window.addEventListener("load",function(e){console.log(e)},!1),storage.set({errorCheck:errorNotOccur});var mediaElement={mode:null},linkArr=[],linkArrTwitter=[],instagramVideo=[],linkVideo=[];if(void 0!==window.frames[0]&&window.frames[0].length>0&&location.href.indexOf("cafe.daum.net")>-1){if(null!==window.frames[0].document.querySelector("img"))var semedia=window.frames[0].document.querySelectorAll("img");else semedia=document.querySelectorAll("img");mediaElement.mode="daum"}else if(void 0!==window.frames[0]&&window.frames[0].length>0&&null!=document.getElementsByTagName("frame")[0]&&document.getElementsByTagName("frame")[0].getAttribute("src")&&document.getElementsByTagName("frame")[0].getAttribute("src").indexOf("blog.naver.com")>-1)try{if(Object.keys(window.frames[0].location).length>3&&null!==window.frames[0].document.querySelector(".se_mediaImage")||null!==window.frames[0].document.querySelector(".se-image-resource")){if(null!==window.frames[0].document.querySelector(".se_mediaImage"))semedia=window.frames[0].document.querySelectorAll(".se_mediaImage");else semedia=window.frames[0].document.querySelectorAll(".se-image-resource");mediaElement.mode="naver"}else{semedia=window.frames[0].document.querySelectorAll("img");mediaElement.mode=null}}catch(e){errorNotOccur=!1,storage.set({errorCheck:errorNotOccur}),location.href=document.getElementsByTagName("frame")[0].getAttribute("src")}else if(void 0!==window.frames[0]&&window.frames[0].length>0&&Object.keys(window.frames[0].location).length>3&&void 0!==window.frames[0].document.querySelectorAll("img")&&window.frames[0].document.querySelectorAll("img").length>0&&(window.frames[0].document.querySelectorAll("img")[0].getAttribute("src").indexOf("pstatic.net")>-1||window.frames[0].document.querySelectorAll("img")[0].getAttribute("src").indexOf(".naver.")>-1))if(null!==window.frames[0].document.querySelector(".se_mediaImage")||null!==window.frames[0].document.querySelector(".se-image-resource")){if(null!==window.frames[0].document.querySelector(".se_mediaImage"))semedia=window.frames[0].document.querySelectorAll(".se_mediaImage");else semedia=window.frames[0].document.querySelectorAll(".se-image-resource");mediaElement.mode="naver"}else{semedia=window.frames[0].document.querySelectorAll("img");mediaElement.mode=null}else if(null!==document.querySelector(".se_mediaImage")||null!==document.querySelector(".se-image-resource")||location.href.indexOf("//blog.naver.com/")>-1||location.href.indexOf("//post.naver.com/")>-1)if(null!==document.querySelector(".se_mediaImage")&&(document.querySelectorAll(".se_mediaImage")[0].getAttribute("src").indexOf("pstatic.net")>-1||document.querySelectorAll(".se_mediaImage")[0].getAttribute("src").indexOf(".naver.")>-1)){semedia=document.querySelectorAll(".se_mediaImage");mediaElement.mode="naver"}else if(void 0!==document.querySelectorAll(".se-image-resource")[0]&&(document.querySelectorAll(".se-image-resource")[0].getAttribute("src").indexOf("pstatic.net")>-1||document.querySelectorAll(".se-image-resource")[0].getAttribute("src").indexOf(".naver.")>-1)){semedia=document.querySelectorAll(".se-image-resource");mediaElement.mode="naver"}else{semedia=document.querySelectorAll("img");mediaElement.mode="naver"}else if(location.href.indexOf("//search.naver.com/search.naver?")>-1){semedia=document.querySelectorAll("img");mediaElement.mode="naverSearch"}else if(null!==document.querySelector(".imageblock")&&document.querySelectorAll(".imageblock img")[0].getAttribute("src").indexOf("tistory")>-1){semedia=document.querySelectorAll(".imageblock img");mediaElement.mode="tistory"}else if(location.href.indexOf("twitter.com")>-1&&document.body.classList.contains("gallery-enabled"))if("none"==document.querySelector(".GalleryNav--prev").style.display&&"none"==document.querySelector(".GalleryNav--next").style.display){semedia=document.querySelectorAll(".Gallery-media img");mediaElement.mode="twitter"}else errorNotOccur=!1,storage.set({errorCheck:errorNotOccur}),location.href=document.querySelector(".GalleryTweet div[data-permalink-path]").getAttribute("data-permalink-path");else if(document.body.classList.contains("overlay-enabled")&&location.href.indexOf("twitter.com")>-1)if(document.querySelectorAll("#permalink-overlay-dialog img[data-aria-label-part]").length>0){semedia=document.querySelectorAll("#permalink-overlay-dialog img[data-aria-label-part]");for(var setcmedia=document.querySelectorAll("#permalink-overlay-dialog a[data-expanded-url]"),i=0;i<setcmedia.length;i++)linkArrTwitter.push(setcmedia[i].getAttribute("data-expanded-url"));mediaElement.mode="twitter"}else if(document.querySelectorAll("#permalink-overlay-dialog video").length>0){semedia=document.querySelectorAll("#permalink-overlay-dialog video");instagramVideo.push(document.querySelector("#permalink-overlay-dialog video").getAttribute("src"));for(setcmedia=document.querySelectorAll("#permalink-overlay-dialog a[data-expanded-url]"),i=0;i<setcmedia.length;i++)linkArrTwitter.push(setcmedia[i].getAttribute("data-expanded-url"));mediaElement.mode="twitterVideo"}else{for(semedia=document.querySelectorAll("img[data-aria-label-part]"),setcmedia=document.querySelectorAll("a[data-expanded-url]"),i=0;i<setcmedia.length;i++)linkArrTwitter.push(setcmedia[i].getAttribute("data-expanded-url"));mediaElement.mode="twitter"}else if(location.href.indexOf("twitter.com")>-1)if(document.getElementById("react-root")){function getQueryStringArgs(e){var t=e.split("?")[1],i={},r=t.length?t.split("&"):[],l=null,a=null,o=null,m=0,n=r.length;for(m=0;m<n;m++)l=r[m].split("="),a=decodeURIComponent(l[0]),o=decodeURIComponent(l[1]),a.length&&(i[a]=o);return i}semedia=[];var imgs=document.getElementsByTagName("img");for(let e=0;e<imgs.length;e++)if(imgs[e].getAttribute("src").indexOf("format")>-1&&imgs[e].getAttribute("src").indexOf("media")>-1){let t=getQueryStringArgs(imgs[e].getAttribute("src")),i=imgs[e].getAttribute("src").split("?")[0];t.name="orig";let r=[];for(let e=0;e<Object.keys(t).length;e++)r.push(Object.keys(t)[e]+"="+t[Object.keys(t)[e]]);let l=i+"?"+r.join("&");semedia.push({src:l})}mediaElement.mode="reacttwitter"}else{semedia=document.querySelectorAll("img");for(let e=0;e<semedia.length;e++)linkArrTwitter.push(semedia[e].getAttribute("src")+":orig");mediaElement.mode="twitter"}else if(location.href.indexOf(".pinterest.")>-1){var imgset=[...document.querySelectorAll("img")];semedia=[...document.querySelectorAll("img")].map(function(e){return e.hasAttribute("srcset")?{src:e.getAttribute("srcset").split(",")[e.getAttribute("srcset").split(",").length-1].trim().split(" ")[0]}:null}).filter(function(e){return null!=e});mediaElement.mode="pinterest"}else if(location.href.indexOf("dcinside.com")>-1){semedia=document.querySelectorAll(".writing_view_box img");mediaElement.mode="dcinside"}else if(location.href.indexOf("theqoo.net")>-1||location.href.indexOf("fmkorea.com")>-1){semedia=document.querySelectorAll("#content article img");mediaElement.mode="xpress"}else if(location.href.indexOf("gguljae.me")>-1){semedia=document.querySelectorAll("article .view-content img");mediaElement.mode="gguljae"}else if(location.href.indexOf("pgr21.com")>-1){semedia=document.querySelectorAll(".viewTable img");mediaElement.mode="pgr21"}else if(location.href.indexOf("mlbpark.donga.com")>-1){semedia=document.querySelectorAll("#contentDetail img");mediaElement.mode="mlbpark"}else if(location.href.indexOf("clien.net")>-1){semedia=document.querySelectorAll(".post_content article img");mediaElement.mode="clien"}else if(location.href.indexOf("ilbe.com")>-1){semedia=document.querySelectorAll(".xe_content img");mediaElement.mode="ilbe"}else if(location.href.indexOf("instiz.net")>-1){semedia=document.querySelectorAll(".memo_content img");mediaElement.mode="instiz"}else if(location.href.indexOf("inven.co.kr/")>-1){semedia=document.querySelectorAll("#imageCollectDiv img");mediaElement.mode="inven"}else if(location.href.indexOf("instagram.com")>-1){var sharedDataAll=document.querySelectorAll("script");if(sharedDataAll.forEach((e,t)=>{!e.hasAttribute("src")&&e.innerHTML.indexOf('"graphql"')>-1&&(sharedData=JSON.parse('{"graphql"'+e.innerHTML.split('{"graphql"')[1].slice(0,-2)))}),null!=location.href.split("www.instagram.com/stories/")[1]&&""!=location.href.split("www.instagram.com/stories/")[1]){if(document.querySelector("video")){instagramVideo.push(document.querySelectorAll("source")[0].getAttribute("src"));semedia=document.querySelectorAll("img[decoding]")}else semedia=document.querySelectorAll("img[decoding]");mediaElement.mode="instagram"}else if(void 0!==sharedData.graphql&&null!=location.href.split("www.instagram.com/p/")[1]&&0==document.querySelectorAll("main a img[srcset]").length&&""!=location.href.split("www.instagram.com/")[1]){if(void 0!==sharedData.graphql.shortcode_media.edge_sidecar_to_children){var instagallery=sharedData.graphql.shortcode_media.edge_sidecar_to_children.edges;semedia=[];instagallery.forEach((e,t)=>{if(e.node.is_video){instagramVideo.push(e.node.video_url);var i=e.node.dash_info.video_dash_manifest.split("<BaseURL>");i.shift(),gettestmedia=i.map(e=>e.split("</BaseURL>")[0]),instagramVideo.push(gettestmedia[0]),instagramVideo.push(gettestmedia[gettestmedia.length-1])}semedia.push(e.node.display_url)})}else{instagallery=sharedData.graphql.shortcode_media;if(console.log(instagallery),instagallery.is_video){instagramVideo.push(instagallery.video_url);var testmedia=instagallery.dash_info.video_dash_manifest.split("<BaseURL>");testmedia.shift(),gettestmedia=testmedia.map(e=>e.split("</BaseURL>")[0]),instagramVideo.push(gettestmedia[0]),instagramVideo.push(gettestmedia[gettestmedia.length-1])}semedia=[instagallery.display_url]}mediaElement.mode="instagram_feed"}else if(null!=location.href.split("www.instagram.com/p/")[1]&&document.querySelectorAll("div[role=dialog]").length>0)errorNotOccur=!1,storage.set({errorCheck:errorNotOccur}),location.reload();else{for(semedia=document.querySelectorAll("main img[srcset]"),setcmedia=document.querySelectorAll("main article a"),i=0;i<setcmedia.length;i++)linkArr.push("https://www.instagram.com"+setcmedia[i].getAttribute("href"));mediaElement.mode="instagram"}}else if(location.href.indexOf("facebook.com")>-1&&document.querySelectorAll("a[rel=theater]").length>0){let e=document.querySelectorAll("a[rel=theater]"),t=[];e.forEach(e=>{e.getAttribute("data-ploi")&&""!=e.getAttribute("data-ploi")&&t.push(e.getAttribute("data-ploi"))});semedia=t;mediaElement.mode="facebook"}else{semedia=document.querySelectorAll("img");mediaElement.mode="null"}console.log(mediaElement.mode);var naverSourcesArray=[],imgElements=[];for(i=0;i<semedia.length;i++){if("naver"==mediaElement.mode)if(null!==semedia[i].getAttribute("data-src")&&(semedia[i].getAttribute("data-src").indexOf("pstatic.net")>-1||semedia[i].getAttribute("data-src").indexOf(".naver.")>-1))var imglink=semedia[i].getAttribute("data-src").split("?")[0].replace("https","http");else if(semedia[i].getAttribute("src").indexOf("pstatic.net")>-1||semedia[i].getAttribute("src").indexOf(".naver.")>-1){var imglocation=semedia[i].getAttribute("src").split("?")[0].split(".")[0].split("/"),naverSources=semedia[i].getAttribute("src").split("?")[0].replace(imglocation[imglocation.length-1],"blogfiles");imglink=relativeToAbsolute(location.href,semedia[i].getAttribute("src"))}else imglink=relativeToAbsolute(location.href,semedia[i].getAttribute("src"));else if("naverSearch"==mediaElement.mode)imglink=semedia[i].getAttribute("src").split("&type")[0];else if("tistory"==mediaElement.mode)imglink=semedia[i].getAttribute("src")+"?original";else if("twitter"==mediaElement.mode)imglink=semedia[i].getAttribute("src")+":orig";else if("twitterVideo"==mediaElement.mode)imglink=semedia[i].poster;else if("dcinside"==mediaElement.mode)if(semedia[i].getAttribute("src").indexOf("viewimage.php")>-1)imglink="http://image.dcinside.com/viewimage.php"+semedia[i].getAttribute("src").split("viewimage.php")[1];else if(null!==semedia[i].getAttribute("src")&&""!==semedia[i].getAttribute("src"))if("//"==semedia[i].getAttribute("src").substring(0,2))imglink="http:"+semedia[i].getAttribute("src");else imglink=relativeToAbsolute(location.href,semedia[i].getAttribute("src"));else imglink=null;else if("instagram"==mediaElement.mode){var srcset=semedia[i].getAttribute("srcset").split(",");imglink=srcset[srcset.length-1].split(" ")[0]}else if("instagram_feed"==mediaElement.mode)imglink=semedia[i];else if("facebook"==mediaElement.mode)imglink=semedia[i];else if(null!==semedia[i].getAttribute("src")&&""!==semedia[i].getAttribute("src"))if("//"==semedia[i].getAttribute("src").substring(0,2))imglink="http:"+semedia[i].getAttribute("src");else imglink=relativeToAbsolute(location.href,semedia[i].getAttribute("src"));else imglink=null;imgElements.push(imglink),naverSources&&naverSourcesArray.push(naverSources)}storage.set({imgcodes:imgElements}),storage.set({realcodes:naverSourcesArray}),storage.set({imgmode:mediaElement.mode}),storage.set({title:document.title}),linkArr.length>0?storage.set({linkArr:linkArr}):naverSourcesArray.length>0?storage.set({linkArr:naverSourcesArray}):storage.remove("linkArr"),linkArrTwitter.length>0?storage.set({linkArrTwitter:linkArrTwitter}):storage.remove("linkArrTwitter"),instagramVideo.length>0?storage.set({instagramVideo:instagramVideo}):storage.remove("instagramVideo");