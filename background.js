var folderDepth="",utakuDown=!1;function utaku_chromedown(e,n){var o=e.filename;if(utakuDown){var t=o.substring(Math.max(o.lastIndexOf("\\"),o.lastIndexOf("."))+1);if(t.indexOf("_")>-1)o=o.substring(0,o.lastIndexOf("."))+"."+(t=t.split("_")[0]);o=folderDepth+o,console.log(o)}n({filename:o})}chrome.runtime.onMessage.addListener(function(e){"utaku_run"==e&&(utakuDown=!0,chrome.downloads.onDeterminingFilename.hasListeners()||(chrome.downloads.onDeterminingFilename.addListener(utaku_chromedown),console.log("Attached Utaku Download Filter"))),"utaku_off"==e&&(utakuDown=!1),e.folderDepth&&(folderDepth="@null%"==e.folderDepth?"":e.folderDepth)}),chrome.extension.onConnect.addListener(function(e){console.log("Utaku Connected ....."),e.onMessage.addListener(function(n){console.log(".js Received ..."+n),e.postMessage("Hello Utaku")}),e.onDisconnect.addListener(function(){utakuDown=!1,chrome.downloads.onDeterminingFilename.hasListeners()&&chrome.downloads.onDeterminingFilename.removeListener(utaku_chromedown),console.log("Removed Utaku Download Filter")})});