function resourceTiming(){var e=window.performance.getEntriesByType("resource");for(i=0;i<e.length;i++)"img"==e[i].initiatorType&&console.log("End to end resource fetch: "+e[i].responseEnd-e[i].startTime)}var folderDepth="";function removeEmojis(e){return e.replace(new RegExp(["[ -⚟]","[⚠-㊟]","[-]"].join("|"),"ug"),"")}var port=chrome.extension.connect({name:"Utaku Down Event"});function callUtaku(){$("#warn").css("display","none"),$("#img_app").css("display","block"),$("body").addClass("opened");var e,t,n,i,l=!0,o="",a=null,s=null,d=null,r=null,c=chrome.storage.local,m={width:500,height:500},u=!1,h=4,p="title",v="themeOne",g="",f=["Sample1","SampleParent/SampleChild"],_=-1;function k(e,t,n,i){if(""!=t&&null!=t&&null!=t){var l=$("<div/>",{id:"img_div_"+e,class:"img_divs"});return $("<label/>",{for:"chck_"+e}).appendTo(l),$("<input/>",{type:"checkbox",id:"chck_"+e,class:"img_checks"}).appendTo(l),$("<button/>",{class:"download","data-url":t}).text("DOWN").appendTo(l),$("<button/>",{class:"zoom"}).text("ZOOM").appendTo(l),i?$("<video/>",{src:t,id:"img_el_"+e,class:"img_els"}).on("loadedmetadata",function(){$(this).prop("muted",!0),$(this).parent().find("span").text("VIDEO : "+this.videoWidth+"px * "+this.videoHeight+"px")}).on("error",function(){n?$(this).parent().addClass("imgOut").html('<a href="'+t+'" target="_blank" class="addAfter">'+t+"</a>"):$(this).parent().remove()}).appendTo(l):$("<img/>",{src:t,id:"img_el_"+e,class:"img_els"}).on("load",function(){$(this).parent().find("span").text(this.naturalWidth+"px * "+this.naturalHeight+"px"),u&&(this.naturalHeight<m.height?$(this).parent().remove():this.naturalWidth<m.width&&$(this).parent().remove()),$("#filtered").text($("#imgs_pack>div").length)}).on("error",function(){n?$(this).parent().addClass("imgOut").html('<a href="'+t+'" target="_blank" class="addAfter">'+t+"</a>"):$(this).parent().remove()}).appendTo(l),$("<span/>",{id:"img_span_"+e}).text("Size").appendTo(l),$("<a/>",{id:"link_a_"+e,target:"_blank",href:t}).text(t).appendTo(l),l}}function w(e){var t=document.getElementById("modal").scrollWidth-document.getElementById("modal").clientWidth,n=document.getElementById("modal").scrollHeight-document.getElementById("modal").clientHeight,i=e.clientX,l=e.clientY,o=i/window.innerWidth,a=l/window.innerHeight;document.getElementById("modal").scrollTo(o*t,a*n)}function C(e){return $.trim(e.replace(/[\/?:~|\.*<>\\\"]/gi,""))}function b(){if($("#folderTitle").val()){var e=$("#folderTitle").val().split("/").map(e=>{if(""!=e)return C(e)}).filter(e=>!!e).join("/");folderDepth=e+"/",l&&(folderDepth=folderDepth+C(removeEmojis(document.title))+"/")}else folderDepth="@null%";""!==folderDepth&&""!==folderDepth&&(chrome.runtime.sendMessage({folderDepth:folderDepth}),chrome.runtime.sendMessage("utaku_run"))}function x(e,t,n,i){chrome.downloads.download({url:t})}function T(){$(".img_divs").hasClass("checked")?($("#desel").addClass("active"),$("#seldo").addClass("active"),$("#alldo").addClass("active")):($("#desel").removeClass("active"),$("#seldo").removeClass("active"),$("#alldo").removeClass("active")),document.querySelectorAll(".img_divs.checked").length===document.querySelectorAll(".img_divs img").length?($("#allsel").addClass("active"),$("#seldo").removeClass("active"),$("#alldo").removeClass("active")):$("#allsel").removeClass("active"),e=$(".checked").length,$("#nowLength").text(e),$("#allLength").text(t)}function y(){"named"!==p&&(_=-1);var e="";$(".folder-lists").empty(),$.each(f,function(t,n){e+=`<li class="folder-li-${t}">\n    <input type="text" name="foldersName_${t}" value="${n}" class="folders-name">\n      <span data-index="${t}" class="fwrap ${-1!=_&&n==g?"active":""}">\n        <button data-index="${t}" class="add-folders">등록</button>\n        <button data-index="${t}" class="remove-folders">제거</button>\n      </span>\n    </li>`}),$(".folder-lists").append(e)}c.get("title",function(e){void 0!==e.title&&(document.title=e.title,c.get("titlebool",function(e){console.log("titlebool",e.titlebool),e.titlebool&&($("#control_pannel").addClass("folderuse"),c.get("folderslist",function(e){void 0!==e.folderslist?(f=e.folderslist.list,_=e.folderslist.set,g=f[_]):(c.set({folderslist:{set:1,list:["Sample1","SampleParent/SampleChild"]}}),f=["Sample1","SampleParent/SampleChild"],g=C(removeEmojis(document.title))),"named"==p?($("#folderTitle").val(f[_]),console.log(g)):(_=-1,$("#folderTitle").val(C(removeEmojis(document.title))),g=C(removeEmojis(document.title))),c.get("pageTitleFolder",function(e){void 0!==e.pageTitleFolder?l=e.pageTitleFolder:c.set({pageTitleFolder:l})})}))}))}),c.get("theme",function(e){void 0!==e.theme?v=e.theme:c.set({theme:v}),$("#imgs_pack").addClass(v)}),c.get("folderSetting",function(e){void 0!==e.folderSetting?p=e.folderSetting:c.set({folderSetting:p})}),c.get("columnNum",function(e){void 0!==e.columnNum?h=e.columnNum:c.set({columnNum:h}),$("#imgs_pack").css("column-count",h)}),c.get("minwidth",function(e){void 0!==e.minwidth?m.width=e.minwidth:c.set({minwidth:m.width}),c.get("minheight",function(e){void 0!==e.minheight?m.height=e.minheight:c.set({minheight:m.height}),c.get("limit_save_auto",function(e){u=e.limit_save_auto,c.get("imgcodes",function(e){a=e.imgcodes,t=a.length,$("#allLength").text(a.length);for(var n=0;n<a.length;n++)$("#imgs_pack").append(k(n,a[n]));c.get("linkArr",function(e){if(void 0!==e.linkArr){var t=e.linkArr;t.length==a.length?($("#linkarr").removeClass("active"),s=t):"naver"==o&&($("#linkarr").removeClass("active"),s=t)}}),c.get("linkArrTwitter",function(e){void 0!==e.linkArrTwitter&&(d=e.linkArrTwitter,$("#linkArrTwitter").removeClass("active"))}),c.get("instagramVideo",function(e){if(void 0!==e.instagramVideo){r=e.instagramVideo;var n=parseInt($("#allLength").text())+a.length;t=n,$("#allLength").text(n);for(var i=0;i<r.length;i++)$("#imgs_pack").append(k(i,r[i],!0,!0))}})})})})}),c.get("imgmode",function(e){o=e.imgmode}),$(document).on("click",".folderuseBtn",function(){$("#control_pannel").hasClass("folderuse")?($("#folderTitle").val(""),c.set({titlebool:!1})):("named"==p?$("#folderTitle").val(g):$("#folderTitle").val(C(removeEmojis(document.title))),c.set({titlebool:!0})),console.log($("#folderTitle").val()),$("#control_pannel").toggleClass("folderuse")}),$(document).on("keyup","#folderTitle",function(){g=$(this).val()}),$(document).on("click","#linkarr",function(){$("#imgs_pack").empty(),$("#allLength").text(s.length),t=s.length;for(var e=0;e<s.length;e++)"naver"==o?$("#imgs_pack").append(k(e,s[e],!1)):$("#imgs_pack").append(k(e,s[e],!0));$("#linkarr").addClass("active"),$("#linkarrBack").addClass("active")}),$(document).on("click","#linkarrBack",function(){$("#imgs_pack").empty(),$("#allLength").text(a.length),t=a.length;for(var e=0;e<a.length;e++)$("#imgs_pack").append(k(e,a[e],!1));$("#linkarr").removeClass("active"),$("#linkarrBack").removeClass("active")}),$(document).on("click","#linkArrTwitter",function(){$("#imgs_pack").empty(),$("#allLength").text(d.length),t=d.length;for(var e=0;e<d.length;e++)$("#imgs_pack").append(k(e,d[e],!0));$("#linkArrTwitter").addClass("active")}),$(document).on("click",".img_els",function(){$(this).parent().find(".img_checks").prop("checked")?($(this).parent().removeClass("checked"),$(this).parent().find(".img_checks").prop("checked",!1)):($(this).parent().addClass("checked"),$(this).parent().find(".img_checks").prop("checked",!0)),T()}),$(document).on("change",".img_checks",function(){$(this).prop("checked")?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked"),T()}),$(document).on("click",".download",function(){var e=$(this).attr("data-url");b(),x(0,e),$(this).addClass("downloaded")}),$(document).on("click",".zoom",function(){$("#modal").addClass("active"),$("body").addClass("modal"),$(this).parent().find("img").length?$("#modal_target").html('<img src="'+$(this).parent().find("img").attr("src")+'"/><button id="real_zoom"><div></div></button>'):$("#modal_target").html('<video src="'+$(this).parent().find("video").attr("src")+'" class="onvideo" controls/>'),$("#modal").scrollTop(0)}),$(document).on("click","#real_zoom",function(){$("#modal_target img").hasClass("real_zoom")?($(this).removeClass("minus"),$("#modal_target img").removeClass("real_zoom"),$("#modal").removeClass("real_zoom"),$(window).off("mousemove",w)):($(this).addClass("minus"),$("#modal_target img").addClass("real_zoom"),$("#modal").addClass("real_zoom"),$(window).on("mousemove",w))}),$(document).on("click","#modal_bg, #modal_target img",function(){$("#modal").removeClass("active"),$("#modal").removeClass("real_zoom"),$("body").removeClass("modal"),$("#modal_target").empty(),$(window).off("mousemove",w)}),$(document).on("click","#allsel",function(){$.each($(".img_divs"),function(e,t){$(t).hasClass("imgOut")||($(t).addClass("checked"),$(t).find("input.img_checks").prop("checked",!0),T())})}),$(document).on("click","#desel",function(){$("input.img_checks").prop("checked",!1),$(".img_divs").removeClass("checked"),T()}),$(document).on("click","#alldo",function(){var e=[],t=$(".img_els");$.each(t,function(t,n){e.push($(n).attr("src"))}),i=0,n=t.length,$("#allLength").text(n),b();for(var l=0;l<e.length;l++){x(0,e[l])}}),$(document).on("click","#seldo",function(){var t=[],l=$(".checked");e=l.length,$.each(l,function(e,n){t.push($(n).find("img").attr("src"))}),i=0,n=l.length,$("#nowLength").text("0"),$("#allLength").text(n),b();for(var o=0;o<t.length;o++){x(0,t[o])}}),$(document).on("change",".minlimit",function(){var e=$(this).attr("data-storage"),t=$(this).attr("data-name");c.set({[e]:$(this).val()}),m[t]=$(this).val()}),$(document).on("click","#removeminwidth",function(){var e=$("#minwidth").val();$.each($("img"),function(){this.naturalWidth<e&&$(this).parent().remove(),$("#filtered").text($("#imgs_pack>div").length)})}),$(document).on("click","#removeminheight",function(){var e=$("#minheight").val();$.each($("img"),function(){this.naturalHeight<e&&$(this).parent().remove(),$("#filtered").text($("#imgs_pack>div").length)})}),$(document).on("click","#limit_both",function(){var e=m.height,t=m.width;$.each($("img"),function(){this.naturalHeight<e?$(this).parent().remove():this.naturalWidth<t&&$(this).parent().remove()})}),$(document).on("click","#limit_save",function(){$(this).hasClass("active")?($(this).removeClass("active"),$(this).find("span").text("OFF"),$("#limit_refresh").removeClass("automode"),c.set({limit_save_auto:!1}),u=!1):($(this).addClass("active"),$(this).find("span").text("ON"),$("#limit_refresh").addClass("automode"),c.set({limit_save_auto:!0}),u=!0)}),u&&$("#limit_refresh").addClass("automode"),$(document).on("click","#limit_refresh",function(){$("#imgs_pack").empty(),$("#allLength").text(a.length),t=a.length;for(var e=0;e<a.length;e++)$("#imgs_pack").append(k(e,a[e]));null!=d&&$("#linkArrTwitter").removeClass("active")}),$(document).on("click","#setColumnMinus",function(){parseInt($("#columnNum").val())<=1?$("#columnNum").val(1):$("#columnNum").val(parseInt($("#columnNum").val())-1),h=$("#columnNum").val(),$("#imgs_pack").css("column-count",h),c.set({columnNum:h})}),$(document).on("click","#setColumnAdd",function(){parseInt($("#columnNum").val())>=8?$("#columnNum").val(8):$("#columnNum").val(parseInt($("#columnNum").val())+1),h=$("#columnNum").val(),$("#imgs_pack").css("column-count",h),c.set({columnNum:h})}),$(document).on("click","#opennewtab",function(){chrome.windows.create({type:"popup",url:chrome.extension.getURL("nt.html")}),window.close()}),$(document).on("click",".themes button",function(){v=$(this).attr("id"),$("#imgs_pack").removeClass(),$(".themes button").removeClass(),$("#imgs_pack").addClass($(this).attr("id")),$(this).addClass("active"),c.set({theme:v})}),$(document).on("change",".folders input",function(){p=$(this).attr("value"),"named"==$(this).attr("value")?c.get("folderslist",function(e){void 0!==e.folderslist&&(_=e.folderslist.set>-1?e.folderslist.set:0,$("#folderTitle").val(f[_]),g=$("#folderTitle").val())}):($("#folderTitle").val(C(removeEmojis(document.title))),g=$("#folderTitle").val()),c.set({folderSetting:$(this).attr("value")})}),$(document).on("mouseenter",".img_divs",function(){$(this).find("video").length&&$(this).find("video")[0].play()}),$(document).on("mouseleave",".img_divs",function(){$(this).find("video").length&&$(this).find("video")[0].pause()}),chrome.downloads.onChanged.addListener(function(e){if(e.state&&"complete"===e.state.current){if(null==n)return;i==n-1?($("#allLength").text("완료"),$("#nowLength").text("완료"),chrome.runtime.sendMessage("utaku_off")):($("#nowLength").text(i++),console.log("nowDownload",i,n))}}),$(window).on("unload",function(){chrome.runtime.sendMessage("utaku_test")}),$(document).on("click","#folderListBtn",function(){var e=`<div class="controls">\n    <div class="foldersSetting">\n      <div id="added_folders">\n        <span class="title">현재폴더명 : </span>\n        <span class="span_inline">\n          <span class="added_folders">${g}</span>\n          <span class="set_page_title_folder"></span>\n        </span>\n      </div>\n      <ul class="folder-lists"></ul>\n      <div class="add-folder-list-box">\n        <button class="get-page-title-folder">페이지 제목 자동추가</button>\n        <button class="add-folder-list">추가</button>\n      </div>\n    </div>\n    <div class="description">\n      <p>상위 폴더를 추가하고 싶으시면 '/'(슬래시)를 추가해주세요. </p>\n      <p>예) 상위폴더이름/하위폴더이름</p>\n      <p> . \\ : * ? " < > | ~ 는 사용불가하며 자동 제거됩니다.</p>\n      <p>지정된 폴더를 유지하고 싶다면 설정->이름설정을 선택해주세요.</p>\n      <p><br/></p>\n      <p>페이지 제목 자동추가를 사용하면 지정한 폴더아래 페이지 제목을 사용한 하위폴더를 생성합니다.</p>\n    </div>\n  </div>`;$("#modal").addClass("active"),$("body").addClass("modal"),$("#modal_target").html(e),y(),l&&($(".get-page-title-folder").addClass("active"),$(".set_page_title_folder").text("/"+C(removeEmojis(document.title)))),$("#modal").scrollTop(0)}),$(document).on("click",".get-page-title-folder",function(){$(this).hasClass("active")?($(".set_page_title_folder").text(""),$(this).removeClass("active"),l=!1):($(".set_page_title_folder").text("/"+C(removeEmojis(document.title))),$(this).addClass("active"),l=!0),c.set({pageTitleFolder:l})}),$(document).on("click",".add-folders",function(){_=$(this).attr("data-index"),g=f[_],""!=f[_]?($(".added_folders").text(g),$("#folderTitle").val(g),$(".fwrap").removeClass("active"),$('.fwrap[data-index="'+_+'"]').addClass("active"),c.set({folderslist:{set:_,list:f}})):alert("빈 값입니다.")}),$(document).on("click",".add-folder-list",function(){var e=f.length,t=`<li class="folder-li-${e}">\n  <input type="text" name="foldersName_${e}" value="" class="folders-name">\n    <span data-index="${e}" class="fwrap">\n      <button data-index="${e}" class="add-folders">등록</button>\n      <button data-index="${e}" class="remove-folders">제거</button>\n    </span>\n  </li>`;$(".folder-lists").append(t),f.push(""),c.set({folderslist:{set:_,list:f}})}),$(document).on("keyup",".folder-lists input",function(){var e=$(this).parent().find(".fwrap").attr("data-index"),t=$(this).val();f[e]=t,-1!=_&&e==_&&($(".added_folders").text(t),$("#folderTitle").val(t)),c.set({folderslist:{set:_,list:f}})}),$(document).on("click",".remove-folders",function(){if(f.length<2)return f[0]="",void $(".folder-li-"+$(this).attr("data-index")+" input").val("");f.splice($(this).attr("data-index"),1),$(".folder-li-"+$(this).attr("data-index")).remove(),y(),c.set({folderslist:{set:_,list:f}})}),$(document).on("click","#img_control",function(){var e=`<div class="controls">\n    <div class="themes">\n      <span class="title">테마 : </span>\n      <button id="themeOne">테마1</button>\n      <button id="themeTwo">테마2</button>\n    </div>\n    <div class="folders">\n      <span class="title">폴더이름 : </span>\n      <input type="radio" name="folders" id="folders_title" value="title" /> <label for="folders_title">타이틀사용</label>\n      <input type="radio" name="folders"  id="folders_named" value="named" /> <label for="folders_named">이름설정</label>\n    </div>\n    <div class="columnNum">\n      <span class="title">칼럼 수(1 ~ 8) : </span>\n      <button id="setColumnMinus">감소</button>\n      <input type="number" min="1" max="8" value="${h}" id="columnNum" data-storage="columnNum">\n      <button id="setColumnAdd">증가</button>\n    </div>\n      <div class="minwidth">\n        <span class="title">가로폭 : </span><input type="number" min="1" value="${m.width}" id="minwidth" class="minlimit" data-storage="minwidth" data-name="width"><span>px 이상</span>\n        <button id="removeminwidth">가로폭 제한</button>\n      </div>\n      <div class="minheight">\n        <span class="title">세로폭 : </span><input type="number" min="1" value="${m.height}" id="minheight" class="minlimit" data-storage="minheight" data-name="height"><span>px 이상</span>\n        <button id="removeminheight">세로폭 제한</button>\n      </div>\n      <div id="img_limit_control">\n        <button id="limit_both">가로세로 제한</button>\n        <button id="limit_save" class="${u?"active":""}">자동 모드<span>${u?"ON":"OFF"}</span></button>\n        <button id="limit_refresh" class="${u?"automode":""}">다시 로드</button>\n      </div>\n    </div>`;$("#modal").addClass("active"),$("body").addClass("modal"),$("#modal_target").html(e),$("#modal").scrollTop(0),$(".themes button#"+v).addClass("active"),$('input[name="folders"][value="'+p+'"]').prop("checked",!0)})}port.postMessage("Run Utaku Filter"),port.onMessage.addListener(function(e){console.log("Utaku Filter Now On"+e)}),chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0].url;t.match(/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/gm)||t===chrome.runtime.getURL("nt.html")?t==chrome.runtime.getURL("nt.html")?setTimeout(()=>{callUtaku()},50):chrome.tabs.executeScript(null,{file:"inject.js"},function(){chrome.storage.local.get("errorCheck",function(e){e.errorCheck?setTimeout(()=>{callUtaku()},100):($("#warn").text("원본 이미지코드 추출을 위해 주소를 재설정합니다.\n다시 실행해주세요."),setTimeout(()=>{window.close()},2500))})}):($("#warn").text("올바르지 않은 경로입니다."),setTimeout(()=>{window.close()},1500))});